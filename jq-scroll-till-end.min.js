var steConfig={length:0};!function(){function a(b,c){if("string"==typeof b){if(b.indexOf(".")===-1)b=window[b];else{var d=b.split("."),e=window;$.each(d,function(a,c){return e?void(e=e[c]):(b=null,!1)}),b=e}return b===window?function(){}:a(b)}return"function"==typeof b?b:c?void 0:function(){}}function b(b,c,d,e){var f=d.dataKey?c[d.dataKey]:c,g=a(d.parse,!0);if("html"===d.dataType.toLowerCase()){if(!f||""===$.trim(f))return $(e).removeClass("scrolling-till-end"),void(1===b?a(d.empty).call(e,c):a(d.end).apply(e));f=[f]}else if(!("json"!==d.dataType.toLowerCase()||f&&Object.keys(f).length))return $(e).removeClass("scrolling-till-end"),void(1===b?a(d.empty).call(e,c):a(d.end).apply(e));$(e).data("pages",b),this.page=b,"boolean"!=typeof d.pageIndicator?$(e).find(".ste-loading").removeClass("ste-loading").html(d.pageIndicator.replace(/\{page\}/i,b)):$(e).find(".ste-loading").removeClass("ste-loading").remove(),g&&$.each(f,function(a,b){$(e).append(g.call(e,b,a))}),a(d.done).call(e,c)}function c(b,c,d){a(b.fail).apply(c,d)}function d(b,c,d){$(c).removeClass("ste-loading"),a(b.always).apply(c,d)}function e(a,e){$(e).addClass("ste-loading");var f=a.data,g=void 0!==a.pages?a.pages+1:2;"object"==typeof f?f[a.pageKey]=g:"string"==typeof f?f+="&"+a.pageKey+"="+g:f=a.pageKey+"="+g,$.ajax({url:a.url,dataType:a.dataType,data:f,success:function(c){b(g,c,a,e)},done:function(c){b(g,c,a,e)},error:function(){c(a,e,Array.from(arguments))},fail:function(){c(a,e,Array.from(arguments))},complete:function(){d(a,e,Array.from(arguments))},always:function(){d(a,e,Array.from(arguments))}})}function f(b,c){if(!$(this).hasClass("ste-loading")){b||(b=$(this),c=$(this));var d=$.extend({},steConfig[$(this).data("config")],$(this).data()),f=d.offset;"string"==typeof f&&(f=f.indexOf("%")!==-1?parseInt(f)*c.height()/100:parseInt(f)),b.scrollTop()+b.innerHeight()+f+10>=c[0].scrollHeight&&!1!==a(d.beforeAjax).call(this)&&e(d,this)}}$.fn.scrollTillEnd=function(a){var b={url:location.href,method:"get",dataType:"html",pageKey:"page",data:{},dataKey:null,loadFirstPage:!1,offset:200,watchSelf:!1,pageIndicator:"- PAGE {page} -",beforeAjax:function(){$(this).append('<div style="text-align:center;padding:10px;margin:10px 0;clear:both;width:100%" class="ste-loading"><i>loading...</i></div>')},parse:function(a){return a},end:function(){$(this).find(".ste-loading").removeClass("ste-loading").html("- THE END -")},empty:function(){},done:function(a){},fail:function(){},always:function(){}};return a&&$.extend(b,a),steConfig[steConfig.length]=b,this.each(function(){$(this).addClass("scrolling-till-end").data("config",steConfig.length);var a=$.extend({},b,$(this).data());a.watchSelf?$(this).scroll(function(){return $(this).hasClass("scrolling-till-end")?void f.call(this):void $(this).unbind("scroll")}):$(this).addClass("document"),a.loadFirstPage&&(a.pages=0,e(a,this))}),steConfig.length++,this},$(document).ready(function(){var a=$(window),b=$("body");a.scroll(function(){$(".scrolling-till-end.document").each(function(){f.call(this,a,b)})})})}(jQuery);
