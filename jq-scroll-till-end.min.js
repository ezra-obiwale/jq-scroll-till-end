
var steConfig={length:0};(function(){function b(j,i){if(typeof j==="string"){if(j.indexOf(".")===-1){j=window[j]}else{var g=j.split("."),h=window;$.each(g,function(l,k){if(!h){j=null;return false}h=h[k]});j=h}return j===window?function(){}:b(j)}if(typeof j==="function"){return j}else{if(!i){return function(){}}}}function f(i,l,g,j){var h=g.dataKey?l[g.dataKey]:l,k=b(g.parse,true);if(g.dataType.toLowerCase()==="html"){console.log($.trim(h)==="",$.trim(h));if($.trim(h)===""||!h){$(j).removeClass("scrolling-till-end");b(g.end).apply(j);return}h=[h]}else{if(g.dataType.toLowerCase()==="json"){if(!h.length){$(j).removeClass("scrolling-till-end");b(g.end).apply(j);return}}}$(j).data("pages",i);this.page=i;$(j).find(".ste-loading").removeClass("ste-loading").html("- PAGE "+i+" -");if(k){$.each(h,function(n,m){$(j).append(k.call(this,m,n))}.bind(this))}b(g.done).call(j,l)}function d(h,i,g){b(h.fail).apply(i,g)}function c(h,i,g){$(i).removeClass("ste-loading");b(h.always).apply(i,g)}function e(g,j){$(j).addClass("ste-loading");var i=g.data,h=g.pages!==undefined?g.pages+1:2;if(typeof i==="object"){i[g.pageKey]=h}else{if(typeof i==="string"){i+="&"+g.pageKey+"="+h}else{i=g.pageKey+"="+h}}$.ajax({url:g.url,dataType:g.dataType,data:i,success:function(k){f(h,k,g,j)},done:function(k){f(h,k,g,j)},error:function(){d(g,j,Array.from(arguments))},fail:function(){d(g,j,Array.from(arguments))},complete:function(){c(g,j,Array.from(arguments))},always:function(){d(g,j,Array.from(arguments))}})}function a(j,i){if($(this).hasClass("ste-loading")){return}if(!j){j=$(this);i=$(this)}var g=$.extend({},steConfig[$(this).data("config")],$(this).data()),h=g.offset;if(typeof h==="string"){h=h.indexOf("%")!==-1?parseInt(h)*i.height()/100:parseInt(h)}if(j.scrollTop()+j.innerHeight()+h+10>=i[0].scrollHeight){if(false!==b(g.beforeAjax).call(this)){e(g,this)}}}$.fn.scrollTillEnd=function(h){var g={url:location.href,method:"get",dataType:"html",pageKey:"page",data:{},dataKey:null,loadFirstPage:false,offset:0,watchSelf:false,beforeAjax:function(){$(this).append('<div style="text-align:center;padding:10px;margin:10px 0;clear:both;width:100%" class="ste-loading"><i>loading...</i></div>')},parse:function(i){return i},end:function(){$(this).find(".ste-loading").removeClass("ste-loading").html("- THE END -")},done:function(i){},fail:function(){},always:function(){}};if(h){$.extend(g,h)}steConfig[steConfig.length]=g;this.each(function(){$(this).addClass("scrolling-till-end").data("config",steConfig.length);var i=$.extend({},g,$(this).data());if(i.watchSelf){$(this).scroll(function(){if(!$(this).hasClass("scrolling-till-end")){$(this).unbind("scroll");return}a.call(this)})}else{$(this).addClass("document")}if(i.loadFirstPage){i.pages=0;e(i,this)}});steConfig.length++;return this};$(document).ready(function(){var h=$(window),g=$("body");h.scroll(function(){$(".scrolling-till-end.document").each(function(){a.call(this,h,g)})})})})(jQuery);